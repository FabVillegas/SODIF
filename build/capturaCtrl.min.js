/*! SOP - v0.1.0 - 2014-11-24 */function capturaCtrl(a,b,c,d,e,f){a.itExists=-1,a.toCheckList=[],a.erase=function(){a.oficio.tipoJuzgado=""},a.oficio={autoridad:"",tipoJuzgado:"",tipoDeJuicio:"",municipio:"",servicio:"",areaDeServicio:"",tipoDeServicio:"",menores:[]},a.listaMenores=[],a.addMenorToList=function(){a.listaMenores.push({edad:"",sexo:"",nombre:"",apellidoPaterno:"",apellidoMaterno:"",respuesta:"Respuesta brindada a petici√≥n"})},a.addMenorToMenores=function(b){a.oficio.menores.push(a.listaMenores[b]),a.listaMenores.splice(b,1)},a.cancelMenor=function(b){a.listaMenores.splice(b,1)},a.cleanInputs=function(){a.oficio={autoridad:"Autoridad correspondiente",tipoJuzgado:"Tipo de Juzgado",tipoDeJuicio:"Tipo de Juicio",municipio:"Municipio",servicio:"Servicio",areaDeServicio:"Area de Servicio",tipoDeServicio:"Tipo de Servicio",menores:[]},a.listaMenores=[]},a.verifyAutoridades=function(a,c,e){var f=b(new Firebase(d.getContadorAutoridadRef(a,c,e))).$asObject();f.$loaded().then(function(a){null===a.$value&&(f.$value=0,f.$save(),f.$destroy())})},a.verifyPriorityCounter=function(a,c){var e=b(new Firebase(d.getRefToSaveCaptura(a,c)+"contPrioridad")).$asObject();e.$loaded().then(function(a){null===a.$value&&(e.$value=0,e.$save(),e.$destroy())})},a.save=function(){if((void 0==a.oficio.fecha||void 0==a.oficio.numero)&&f.open({template:"alertMessage"}),"Autoridad correspondiente"==a.oficio.autoridad||"Tipo de Juzgado"==a.oficio.tipoJuzgado||"Tipo de Juicio"==a.oficio.tipoDeJuicio||"Municipio"==a.oficio.municipio||"Servicio"==a.oficio.servicio||"Area de Servicio"==a.oficio.areaDeServicio||"Area de Servicio"==a.oficio.areaDeServicio||"Tipo de Servicio"==a.oficio.tipoDeServicio)f.open({template:"missingFieldsMessage"});else{var c=e.getYear(a.oficio.fecha),g=e.getMonth(a.oficio.fecha);a.verifyAutoridades(c,g,"PGJE"),a.verifyAutoridades(c,g,"PJE"),a.verifyAutoridades(c,g,"PJF"),a.verifyPriorityCounter(c,g);var h=b(new Firebase(d.getRefToSaveCaptura(c,g)+"contPrioridad")).$asObject(),i=a.oficio.numero;h.$loaded().then(function(a){console.log(a.$value);var b=new Firebase(d.getRefToSaveCaptura(c,g));b.child(i).setWithPriority(!0,a.$value)});var j=new Firebase(d.getRefToSaveCaptura(c,g)+"contPrioridad");j.transaction(function(a){return(a||0)+1});var k=b(new Firebase(d.getRefToSaveOficio()));k.$set(a.oficio.numero,a.oficio);var l=new Firebase(d.getContadorOficiosRef(c,g));l.transaction(function(a){return(a||0)+1});var m=new Firebase(d.getContadorMenoresRef(c,g)),n=a.oficio.menores.length;m.transaction(function(a){return(a||0)+n});var o=new Firebase(d.getContadorAutoridadRef(c,g,a.oficio.autoridad));o.transaction(function(a){return(a||0)+1});var p=new Firebase(d.getContadorJuzgadoRef(c,g,a.oficio.autoridad,a.oficio.tipoJuzgado));p.transaction(function(a){return(a||0)+1});var q=new Firebase(d.getContadorJuiciosRef(c,g,a.oficio.tipoDeJuicio));q.transaction(function(a){return(a||0)+1});var r=new Firebase(d.getContadorMunicipiosRef(c,g,a.oficio.municipio));r.transaction(function(a){return(a||0)+1}),f.open({template:"successMessage",closeByDocument:!0,closeByEscape:!0}),a.cleanInputs()}},a.closeDialog=function(){f.close({template:"successMessage",template:"alertMessage"})},a.checkOficios=function(){a.toCheckList=b(new Firebase(d.getRefToSaveOficio())).$asArray(),a.toCheckList.$watch(function(){a.itExists=a.toCheckList.$indexFor(a.oficio.numero),a.disableStyle=-1!=a.itExists?{"background-color":"grey","border-color":"black"}:{}})},a.cleanInputs()}angular.module("sodif").controller("capturaCtrl",capturaCtrl),capturaCtrl.$inject=["$scope","$firebase","$state","firebaseRefFactory","dateFactory","ngDialog"];